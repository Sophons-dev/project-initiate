#!/bin/sh

echo '👷‍♂️ Starting pre-commit checks...'

# Get list of staged files before formatting
STAGED_FILES=$(git diff --cached --name-only)

echo '🎨 Formatting ...'
bun run format || {
  echo '❌ Formatting failed.'
  exit 1
}

echo '🧹 Linting ...'
bun run lint || {
  echo '❌ Linting failed. Please fix the errors before committing.'
  exit 1
}

# Only add back the files that were originally staged
if [ -n "$STAGED_FILES" ]; then
  echo "$STAGED_FILES" | xargs git add
fi

echo '✅ All pre-commit checks passed. Proceeding with commit. 🚀'
