// Opportunity Models
// This file contains all opportunity-related models

model Opportunity {
  id                String                      @id @default(auto()) @map("_id") @db.ObjectId
  type              OpportunityType
  subtype           OpportunitySubtype
  title             String
  description       String
  matchReason       String

  // Core job details
  jobDescription    String
  responsibilities  String[]
  requirements      String[]
  benefits          String[]

  // Location details (embedded)
  locationType      String
  city              String
  country           String
  workLocation      String

  url               String

  // Important dates
  postedDate        String
  applicationDeadline String
  daysAgoPosted     String

  // Core metadata for AI matching (JSON)
  metadata          Json

  // Company benefits (JSON)
  companyBenefits   Json

  // Organization reference
  organizationId    String                      @db.ObjectId
  createdBy         String                      @db.ObjectId
  createdAt         DateTime?
  updatedAt         DateTime?
  recommendations   OpportunityRecommendation[]
  userOpportunities UserOpportunity[]
  organization     Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([createdBy])
  @@index([type])
  @@index([city])
}

model OpportunityRecommendation {
  id            String      @id @default(auto()) @map("_id") @db.ObjectId
  userId        String      @db.ObjectId
  opportunityId String      @db.ObjectId
  score         Float?
  rank          Int?
  reasoning     String?
  tagsMatched   String[]
  modelVersion  String?
  createdAt     DateTime?
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  opportunity   Opportunity @relation(fields: [opportunityId], references: [id])

  @@index([userId])
  @@index([opportunityId])
}
